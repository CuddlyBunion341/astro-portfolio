---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";
const allBlogPosts = await getCollection("blog");
const allProjects = await getCollection("projects");
import allTags from "../../data/tags.json";

const mergedTags = [...allTags];

const entryTags = [...allBlogPosts, ...allProjects]
  .map((entry) => entry.data.tags)
  .flat();

entryTags.forEach((tag) => {
  if (!mergedTags.find((t) => t.slug === tag)) {
    mergedTags.push({
      slug: tag,
      name: tag.replace(/\b\w/g, (l: string) => l.toUpperCase()),
      description: "",
    });
  }
});
---

<BaseLayout>
  <ul>
    {
      mergedTags.map((tag) => (
        <li>
          <h2>{tag.name}</h2>
          <p>{tag.description}</p>
          {tag.icon && <i class={tag.icon} />}
          <p>
            {
              allProjects.filter((project) =>
                project.data.tags.includes(tag.slug),
              ).length
            }{" "}
            Projects
            <a href={`/projects?tag=${tag.slug}`}>View Projects</a>
          </p>
          <p>
            {
              allBlogPosts.filter((post) => post.data.tags.includes(tag.slug))
                .length
            }{" "}
            Blog Posts
            <a href={`/blog?tag=${tag.slug}`}>View Blog Posts</a>
          </p>
        </li>
      ))
    }
  </ul>
</BaseLayout>
